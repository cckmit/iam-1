# Copyright (c) 2017 ~ 2025, the original author wangl.sir individual Inc,
# All rights reserved. Contact us <Wanglsir@gmail.com, 983708408@qq.com>
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# #### IAM Gateway configuration. ####
#
spring:
  cloud:
    circuitbreaker:
      resilience4j:
        enabled: true
  iam:
    gateway:
      authing:
        simple-sign:
          secret-load-store: redis
          secret-load-prefix: iam:gateway:auth:sign:secret
          secret-local-cache-seconds: 6 # Default by 6sec
          # Ignore authentication in JVM debug mode, often used for rapid development and testing environments.
          ignored-authing-in-jvm-debug: true # Default by false
          sign-replay-verify-bloom-load-prefix: iam:gateway:auth:sign:replay:bloom
      ratelimit: {}
      route:
        refresh-delay-ms: 30_000
      loadbalancer:
        version-gray-load-balance-metadata-key: Iam-Gateway-Gray-Version
        version-gray-load-balance-request-header: X-Iam-Gateway-Gray-Version
        fallback-to-get-from-query-param: true
      trace:
        trace-id-request-header: X-Simple-Trace-Id
      logging:
        # If the mandatory switch is not set, it is determined whether to enable logging according to
        # the preference switch, otherwise it is determined whether to enable logging according to the
        # mandatory switch, the default mandatory switch is empty, the preference switch is enabled.
        #required-flight-log-enabled: # Options:(null|true|false)
        preferred-flight-log-matches-mode: EQ # Options(EQ|IGNORECASE_EQ||PREFIX|IGNORECASE_PREFIX|SUFFIX|IGNORECASE_SUFFIX|INCLUDE|IGNORECASE_INCLUDE)
        preferred-flight-log-matches-header: 'X-Iam-Gateway-Log-Enabled'
        preferred-flight-log-matches-query: '__iam_gateway_log_enabled'
        preferred-flight-log-matches-value: 'y'
        # The output level of flight log printing, similar to kubectl design value range: 1-10, 1 is coarse-grained log, 10 is the most fine-grained log.
        preferred-flight-log-verbose-level: 10
  # Security configuration.
  security:
    oauth2:
      client:
        provider:
          keycloak:
            issuer-uri: https://iam.wl4g.com/realms/master
        registration:
          keycloak:
            client-id: portal
            client-secret: a12463984c2f46bdb83d9b1313f3378d
            scope:
            - email
            - profile
            - roles

#eureka:
#  client:
#    registerWithEureka: false
#    fetchRegistry: false

# Logging configuration.
logging:
  file:
    # see:com.wl4g.infra.core.logging.logback.EnhancedLogbackConfigurer#apply
    # see:org.springframework.boot.logging.LogFile#toString
    name: /mnt/disk1/log/${spring.application.name}/${spring.application.name}.log
    clean-history-on-start: false # By default: false
    total-size-cap: 200GB # By default: 200GB
    max-size: 1GB # By default: 500MB
    max-history: 30 # By default: 7
  pattern:
    #console: ${logging.pattern.file.name}
    #file: '%d{yy-MM-dd HH:mm:ss.SSS} ${LOG_LEVEL_PATTERN:%4p} ${PID} [%t] [%X{_H_:X-Request-ID}] [%X{_H_:X-Request-Seq}] [%X{_C_:${spring.cloud.devops.iam.cookie.name}}] - %-40.40logger{39} : %m%n${LOG_EXCEPTION_CONVERSION_WORD:%wEx}'
    #dateformat: yyyy-MM-dd HH:mm:ss.SSS
    #level: '%5p'
    #rolling-file-name: ${LOG_FILE}.%d{yyyy-MM-dd}.%i.gz
  root: INFO
  level:
    de.codecentric.boot.admin: INFO
    reactor.netty.http.client: INFO
    org:
      springframework: INFO
        #boot.context.config: DEBUG # Print load config
      apache: INFO
    feign: DEBUG
    com:
      wl4g.iam.gateway: INFO

# ### Server configuration.
server:
  port: 18085
  #address: 0.0.0.0
  sessionTimeout: 30
  servlet:
    #contextPath: /${spring.application.name}
    # because spring-cloud-loadbalancer-2.2.6 not support metadata.contextPath
    contextPath: /
      